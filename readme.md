# VK to Neo4j Data Importer
Этот проект импортирует данные из социальной сети ВКонтакте в базу данных Neo4j, включая информацию о пользователях, их фолловерах и подписках. Данные загружаются с помощью VK API и сохраняются в графовой базе данных Neo4j. Также предоставляется дополнительный скрипт для выполнения различных запросов к Neo4j, чтобы анализировать импортированные данные.

## Установка
### Требования
- Python 3.7+
- Neo4j Community Edition
- Библиотеки Python: `requests`, `logging`, `python-dotenv`, `neo4j`
### Шаги установки
1. Клонируйте репозиторий или загрузите файлы.

2. Создайте файл `.env` в корневом каталоге проекта и добавьте следующие переменные:

```.env
NEO4J_USER=ваш_пользователь_neo4j
NEO4J_PASSWORD=ваш_пароль_neo4j
VK_ACCESS_TOKEN=ваш_токен_доступа_VK
```
Получите `VK_ACCESS_TOKEN` в настройках приложения ВКонтакте, с правами доступа к `friends`, `groups`, `users`.

3. Установите зависимости:

```bash
pip install -r requirements.txt
```

4. Настройка Neo4j: 

Убедитесь, что Neo4j запущен, и вы можете подключиться к нему через `neo4j_url = "bolt://localhost:7687"`.

## Скрипты
### 1. Основной скрипт: `script.py`
Этот скрипт используется для импорта данных из ВКонтакте в Neo4j.

#### Запуск:

```bash
python script.py
```
#### Параметры в коде:

- `user_id_input`: ID пользователя ВКонтакте для начала загрузки данных (замените на нужный ID).
- `max_level`: максимальная глубина уровней для загрузки данных (по умолчанию 2).
- `max_users`:` максимальное количество узлов (пользователей и групп), которые будут добавлены в граф.
#### Основные функции:

- `vk_api_request(method, params)`: Выполняет запрос к VK API и возвращает данные.
- `get_user_data(user_id)`: Получает основные данные о пользователе.
- `get_followers(user_id)`: Получает список ID фолловеров пользователя.
- `get_followers_info(follower_ids)`: Получает информацию о фолловерах пользователя.
- `get_subscriptions(user_id)`: Получает подписки пользователя.
- `get_groups_info(group_ids)`:` Получает информацию о группах.
- `save_user(tx, user)`: Сохраняет пользователя в Neo4j.
- `save_group(tx, group)`: Сохраняет группу в Neo4j.
- `create_relationship(tx, user_id, target_id, rel_type)`: Создает связь между узлами.
### 2. Запросы: `queries.py`
Скрипт `queries.py` выполняет запросы к Neo4j для анализа данных, импортированных из ВКонтакте. Он использует `argparse` для выполнения различных запросов на основе переданных параметров командной строки.

#### Запуск:

```bash
python queries.py [параметры]
```
#### Доступные параметры:

- `--total_users`: Получить общее количество пользователей.
- `--total_groups`: Получить общее количество групп.
- `--top_users`: Получить топ-5 пользователей по количеству фолловеров.
- `--top_groups`: Получить топ-5 самых популярных групп.
- `--mutual_followers`: Получить всех пользователей, которые являются фолловерами друг друга.
#### Примеры использования:

- Получить общее количество пользователей:

```bash
python queries.py --total_users
```
- Получить топ-5 пользователей по количеству фолловеров:

```bash
python queries.py --top_users
```
Функции в queries.py:

- `get_total_users()`: Возвращает общее количество пользователей в базе.
- `get_total_groups()`: Возвращает общее количество групп в базе.
- `get_top_5_users_by_followers()`: Возвращает топ-5 пользователей по количеству фолловеров.
- `get_top_5_popular_groups()`: Возвращает топ-5 самых популярных групп.
- `get_mutual_followers()`: Возвращает всех пользователей, которые фолловеры друг друга.

#### Логирование
Оба скрипта записывают логирование на уровень `INFO`, чтобы отслеживать ход выполнения и любые возникающие ошибки.

## Примечания
- Ограничение по API: ВКонтакте имеет ограничения по количеству запросов, поэтому при большом количестве пользователей и уровней глубины скрипт может столкнуться с ограничениями.
- Тестирование восстановления: Если вы хотите протестировать восстановление данных, создайте отдельный дамп вашей текущей базы данных.